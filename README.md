# Потоковые шифры

## RC4 (Rivest Cipher 4)

### Принцип работы
RC4 - это потоковый шифр, разработанный Роном Ривестом в 1987 году для компании RSA Security. Основные принципы работы:

1. **Инициализация:**
   - Создается S-бокс (массив перестановок) размером 256 байт, содержащий все значения от 0 до 255
   - Ключ (длиной от 1 до 256 байт) используется для начальной перестановки S-бокса

2. **Генерация псевдослучайного потока:**
   - Два указателя i и j инициализируются нулями
   - На каждой итерации:
     - i = (i + 1) mod 256
     - j = (j + S[i]) mod 256
     - Значения S[i] и S[j] меняются местами
     - Выходной байт: S[(S[i] + S[j]) mod 256]

3. **Шифрование:**
   - Каждый байт открытого текста XOR-ится с соответствующим байтом псевдослучайного потока

### Достоинства и недостатки
**Достоинства:**
- Простота реализации
- Высокая скорость работы

**Недостатки:**
- Уязвимости в реализации (например, в WEP)
- Отсутствие аутентификации
- Слабость при неправильном использовании (повторное использование ключей)

## ChaCha20

### Принцип работы
ChaCha20 - это потоковый шифр, разработанный Даниэлем Бернштейном в 2008 году как улучшенная версия алгоритма Salsa20.

1. **Состояние:**
   - 4×4 матрица 32-битных слов (всего 512 бит)
   - Константы, ключ (256 бит), счетчик и одноразовый номер (nonce)

2. **Функция четверть-раунда:**
   - Применяет четыре операции модульного сложения, побитового XOR и циклического сдвига (rotation) к четырем словам

3. **Раунд:**
   - Состоит из восьми четверть-раундов: сначала четыре по "столбцам", затем четыре по "диагоналям"

4. **Полный алгоритм:**
   - Инициализация состояния константами, ключом, счетчиком и nonce
   - 20 раундов (10 двойных раундов) преобразования
   - Сложение финального состояния с исходным
   - Вывод 64-байтного блока ключевого потока

5. **Шифрование:**
   - XOR открытого текста с сгенерированным ключевым потоком

### Достоинства и недостатки
**Достоинства:**
- Высокая производительность на программном уровне
- Устойчивость к атакам по времени
- Простота реализации и анализа
- Высокий уровень безопасности

**Недостатки:**
- Относительно новый алгоритм (меньше проанализирован)
- Требует правильного управления одноразовыми номерами (nonce)

## Salsa20

### Принцип работы
Salsa20 - потоковый шифр, разработанный Даниэлем Бернштейном в 2005 году.

1. **Структура состояния:**
   - 4×4 матрица 32-битных слов (всего 512 бит)
   - Состоит из констант, ключа (256 бит), счетчика и одноразового номера (nonce)

2. **Функция квартет:**
   - Выполняет преобразование четырех слов с использованием операций сложения, XOR и циклических сдвигов

3. **Преобразование состояния:**
   - Состоит из 20 раундов (или 8/12 в облегченных версиях)
   - Чередующиеся преобразования по строкам и столбцам матрицы

4. **Генерация ключевого потока:**
   - Исходное состояние преобразуется и складывается с начальным состоянием
   - Результат используется как 64-байтный блок ключевого потока
   - Для следующего блока увеличивается значение счетчика

5. **Шифрование:**
   - XOR открытого текста с ключевым потоком

### Достоинства и недостатки
**Достоинства:**
- Высокая производительность
- Возможность параллельной обработки
- Отсутствие уязвимостей к атакам по времени
- Простота реализации

**Недостатки:**
- Менее диффузионные свойства по сравнению с ChaCha20
- Требует корректного использования нонсов и счетчиков

## Сравнение алгоритмов

| Алгоритм | Год создания | Размер ключа | Особенности |
|----------|--------------|--------------|-------------|
| RC4      | 1987         | 40-2048 бит  | Простота, компактность, проблемы безопасности |
| Salsa20  | 2005         | 256 бит      | Высокая скорость, параллельная обработка |
| ChaCha20 | 2008         | 256 бит      | Улучшенная диффузия, встроен в TLS 1.3 |

В современной криптографии ChaCha20 (в сочетании с Poly1305) считается предпочтительным выбором среди данных алгоритмов благодаря оптимальному сочетанию безопасности и производительности.
